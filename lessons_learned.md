### 2025-07-19 - Markdown Post Processor Not Invoked

- **Issue:** Markdown post-processors (including a simple test one) were not being invoked by Obsidian, preventing granular redaction from working.
- **Diagnosis:** Initial debugging confirmed `applyFullNoteRedaction` was called, but `markdownPostProcessor` was not. A simple test post-processor was added directly in `main.ts` to rule out issues with `RedactionManager`'s implementation, but it also failed to invoke. This indicates the problem lies with Obsidian's `registerMarkdownPostProcessor` mechanism itself in the user's environment, possibly due to plugin conflicts, Obsidian state corruption, or an unusual rendering pipeline.
- **Resolution:** (Pending user feedback on troubleshooting steps: restarting Obsidian, disabling other plugins, testing in a new vault.)
- **Learning:** When core Obsidian APIs (like `registerMarkdownPostProcessor`) do not behave as expected, the issue may be external to the plugin's code. Systematic troubleshooting involving environment isolation (disabling other plugins, new vaults) and verifying Obsidian's internal state is crucial.

### 2025-07-20 - Block IDs in DOM for Granular Redaction (Revisited and Finalized)

- **Issue:** Granular redaction relies on identifying specific Markdown blocks in the rendered HTML, but `data-block-id` attributes (which would directly link DOM elements to Obsidian's block IDs) are *not* present on rendered block elements. This was confirmed by the user, contradicting initial web search results.
- **Diagnosis:** The `MarkdownPostProcessor` receives an `HTMLElement` representing a *section* of the document (`el`), and `ctx.getSectionInfo(el)` provides its line range. While `fileCache.blocks` provides block IDs and their line numbers, there is no reliable, direct API-provided mechanism to map a specific Markdown source line number to its corresponding `HTMLElement` within the `el` (section element) in the `MarkdownPostProcessor` context. Attempting to infer this mapping through heuristics (e.g., iterating `el.children` and guessing line correspondence) is fragile and unreliable.
- **Resolution:** The `MarkdownPostProcessor` is not suitable for precise granular block-level redaction when `data-block-id` is absent. A different approach is required.
- **Learning:** **Crucial:** Always prioritize and trust direct user input and observations, especially when they contradict information from external sources like web searches. External search results can be outdated or misinterpret context. The `MarkdownPostProcessor` is designed for post-processing *rendered HTML sections*, not for precise mapping of source Markdown lines to arbitrary DOM elements within those sections without explicit DOM attributes (like `data-block-id`). For precise block-level control, alternative Obsidian APIs like `registerMarkdownPreProcessor` (for pre-rendering Markdown manipulation) or `MarkdownRenderChild` (for custom rendering of specific Markdown elements) should be explored, despite their increased complexity.